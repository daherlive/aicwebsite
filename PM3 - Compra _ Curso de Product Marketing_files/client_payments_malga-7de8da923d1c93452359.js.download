/*! For license information please see client_payments_malga-7de8da923d1c93452359.js.LICENSE.txt */
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/packs/",n(n.s=32)}([function(e,t,n){"use strict";n.r(t),n.d(t,"isPJ",(function(){return g})),n.d(t,"doesNotHaveValue",(function(){return h})),n.d(t,"setElementHiddenClass",(function(){return b})),n.d(t,"disableSubmitButtonElement",(function(){return _})),n.d(t,"disableInputField",(function(){return E})),n.d(t,"disableRequiredInputField",(function(){return w})),n.d(t,"checkoutCustomerFormHelpers",(function(){return O})),n.d(t,"parseFetchResponse",(function(){return x})),n.d(t,"objectToInlineCss",(function(){return I})),n.d(t,"querySelectorOrFail",(function(){return C})),n.d(t,"blurOnEnterKeyupHandler",(function(){return j})),n.d(t,"forceBlurOnEventHandler",(function(){return P}));var r=["00000000000","11111111111","22222222222","33333333333","44444444444","55555555555","66666666666","77777777777","88888888888","99999999999","12345678909"],o=/[.-]/g,a=/[^\d]/g,u=function(e){var t=e.split("").map((function(e){return parseInt(e,10)})),n=t.length+1,r=t.map((function(e,t){return e*(n-t)})).reduce((function(e,t){return e+t}))%11;return r<2?0:11-r},i=function(e,t){var n=t?o:a;return(e||"").replace(n,"")},c=function(e,t){var n=i(e,t);if(!n)return!1;if(11!==n.length)return!1;if(r.includes(n))return!1;var o=n.substr(0,9);return o+=u(o),(o+=u(o)).substr(-2)===n.substr(-2)},l=["00000000000000","11111111111111","22222222222222","33333333333333","44444444444444","55555555555555","66666666666666","77777777777777","88888888888888","99999999999999"],s=/[-\\/.]/g,d=/[^\d]/g,m=function(e){var t=2,n=e.split("").reduce((function(e,t){return[parseInt(t,10)].concat(e)}),[]).reduce((function(e,n){return e+=n*t,t=9===t?2:t+1,e}),0)%11;return n<2?0:11-n},p=function(e,t){var n=t?s:d;return(e||"").replace(n,"")},f=function(e,t){var n=p(e,t);if(!n)return!1;if(14!==n.length)return!1;if(l.includes(n))return!1;var r=n.substr(0,12);return r+=m(r),(r+=m(r)).substr(-2)===n.substr(-2)};function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],u=!0,i=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==n.return||n.return()}finally{if(i)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=function(e){return"PJ"===e.trim().toUpperCase()},h=function(e){var t;return""===(null!==(t=null===e||void 0===e?void 0:e.value.trim())&&void 0!==t?t:"")},b=function(e,t){e.classList.toggle("hidden",t)},_=function(e,t){e.disabled=t,e.classList.toggle("cursor-not-allowed",t),e.classList.toggle("opacity-60",t)},E=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n&&(e.value=""),e.disabled=t,e.style=t?"background-color: #e0e0e0;":""},w=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];E(e,t,n),e.required=!t},O=function(e){var t=e.alertMessageDocumentElement,n=e.documentLabelElement,r=e.formDocumentElement,o=e.formPhoneNumberElement,a=e.formClientType,u=e.isForeignerElement,i=e.submitButtonElement,l=e.whatsappAcceptElement,s=e.whatsappLabelElement;function d(e,n){var r=t.querySelector(".document_empty"),o=t.querySelector(".document_invalid");n?(b(r,!1),b(o,!0)):e&&(b(r,!0),b(o,!1)),b(t,!e),_(i,e)}var m=g(a.value),p={pjMode:m,cpfCnpjValidator:function(){var e,t;if(null!==u&&void 0!==u&&u.checked)return!0;var n=null!==(e=null===(t=r.value)||void 0===t?void 0:t.trim())&&void 0!==e?e:"",o=n.split("").filter((function(e){return/^\d$/.test(e)})).length>0,a=o&&(m?f(n):c(n));if(r.required)return d(!a,!o),a;var i=!o||a;return d(!i,!1),i},disableCpfCnpjFields:u?function(e){var t=n.querySelector("small");(!t||t&&t.classList.contains("inline-zero-width"))&&n.classList.toggle("required",!e),w(r,e),e&&d(!1,!1)}:void 0,phoneNumberChangeHandler:function(){var e=o.value.split("").filter((function(e){return/\d/.test(e)})).length>6;l.checked=e,l.classList.toggle("hidden",!e),s.classList.toggle("hidden",!e)}};return r.addEventListener("blur",(function(){p.cpfCnpjValidator(a)})),u&&u.addEventListener("change",(function(e){p.disableCpfCnpjFields(e.target.checked)})),o.addEventListener("keyup",p.phoneNumberChangeHandler),p},x=function(e){return e.json().then((function(t){return{status:e.status,body:t}}))},I=function(e){return Object.entries(e).map((function(e){var t=v(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")},C=function(e){var t=document.querySelector(e);if(!t)throw new Error("Not element found with query "+e);return t};function j(e){"Enter"===e.key&&(e.target.blur(),document.activeElement.blur())}function P(){document.activeElement.blur()}},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";n.r(t),n.d(t,"formatterCurrency",(function(){return r})),n.d(t,"getFormattedCurrencyValueFromEl",(function(){return o})),n.d(t,"getValueWithoutFormat",(function(){return a})),n.d(t,"getLowerCaseInputValue",(function(){return u}));var r=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),o=function(e){var t;return!("value"in e)||!e.value||(null===(t=e.value)||void 0===t?void 0:t.trim().length)<1?0:r.format(e.value/100)},a=function(e){return e.replace(/[^0-9,.]+/gm,"").replace(",",".").replace(".","")},u=function(e){return e.value.toString().toLowerCase()}},function(e,t,n){"use strict";n.r(t),n.d(t,"CHECKOUT_STEP",(function(){return r})),n.d(t,"PAYMENT_TYPE",(function(){return o})),n.d(t,"GtmFactory",(function(){return a}));var r=Object.freeze({begin_checkout:"begin_checkout",add_payment_info:"add_payment_info",purchase:"purchase"}),o=Object.freeze({card:"Cart\xe3o de Cr\xe9dito",pix:"PIX",nupay:"Nupay"});function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.dataLayer||[],t=function(t,n){e.push({ecommerce:null}),e.push({event:t,ecommerce:n})},n=function(e,t){var n={currency:"BRL",value:e.totalAmount,items:[{index:0,item_id:e.productId,item_name:e.productName,coupon:e.coupon||"",currency:"BRL",discount:e.discount||0,price:e.price,quantity:1}]};return t&&(n.paymentType=t),e.transactionId&&(n.transaction_id=e.transactionId),n};return{dataLayer:e,sendEvent:function(e,r,o){t(e,n(r,o))},sendBeginCheckout:function(e){var t=e.unitAmount,n=e.productId,o=e.productName;this.sendEvent(r.begin_checkout,{totalAmount:t,productId:n,productName:o,price:t})},registerCheckoutOptionEvent:function(e,t){var n={price:t.unitAmount,discount:t.amountOff,coupon:t.couponId,productName:t.productName,productId:t.productId,totalAmount:t.totalAmount};this.sendEvent(r.add_payment_info,n,e)},registerPurchaseEvent:function(e,t){var n=t.product_id,o=t.transaction_id,a=t.coupon_id,u=t.product_name,i=t.unitAmount,c=t.totalAmount,l={transactionId:o,coupon:a,productId:n,productName:u,price:i,discount:i-c,totalAmount:c};this.sendEvent(r.purchase,l,e)}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"CouponService",(function(){return u}));var r=n(1),o=n.n(r);function a(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}var u={getCoupon:function(e,t,n,r){return(u=o.a.mark((function a(){var u,i,c,l,s;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return u=new URLSearchParams({amount:t,product_id:n,email:r}),o.next=3,fetch("/coupon_payments/".concat(e,"?").concat(u));case 3:if((i=o.sent).ok){o.next=6;break}throw new Error("Failed to get coupon: ".concat(i.statusText));case 6:return o.next=8,i.json();case 8:if(!("error"in(c=o.sent))){o.next=11;break}throw new Error(e.error);case 11:return l=c.discount_amount,s=c.new_amount,o.abrupt("return",{coupon:e,amount:t,amountOff:c.amount_off,percentOff:c.percent_off,discountAmount:l,discountedAmount:s});case 14:case"end":return o.stop()}}),a)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var o=u.apply(e,t);function i(e){a(o,n,r,i,c,"next",e)}function c(e){a(o,n,r,i,c,"throw",e)}i(void 0)}))})();var u}}},function(e,t,n){"use strict";n.r(t),n.d(t,"webhook",(function(){return i}));var r=n(1),o=n.n(r);function a(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var u=e.apply(t,n);function i(e){a(u,r,o,i,c,"next",e)}function c(e){a(u,r,o,i,c,"throw",e)}i(void 0)}))}}var i=Object.freeze({sendPost:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{"Content-Type":"application/json"};return fetch(e,{method:"POST",headers:n,body:JSON.stringify(t)}).then(function(){var e=u(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.ok,e.t1=t.status,e.t2=t.statusText,e.next=5,t.ok?t.json():t.text();case 5:return e.t3=e.sent,e.abrupt("return",{ok:e.t0,status:e.t1,statusText:e.t2,body:e.t3});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return{ok:!1,error:e}}))}})},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"===typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(L){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),u=new P(r||[]);return a._invoke=function(e,t,n){var r=d;return function(o,a){if(r===p)throw new Error("Generator is already running");if(r===f){if("throw"===o)throw a;return A()}for(n.method=o,n.arg=a;;){var u=n.delegate;if(u){var i=I(u,n);if(i){if(i===v)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var c=s(e,t,n);if("normal"===c.type){if(r=n.done?f:m,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}(e,n,u),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}e.wrap=l;var d="suspendedStart",m="suspendedYield",p="executing",f="completed",v={};function y(){}function g(){}function h(){}var b={};c(b,a,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(S([])));E&&E!==n&&r.call(E,a)&&(b=E);var w=h.prototype=y.prototype=Object.create(b);function O(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(o,a,u,i){var c=s(e[o],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"===typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,u,i)}),(function(e){n("throw",e,u,i)})):t.resolve(d).then((function(e){l.value=e,u(l)}),(function(e){return n("throw",e,u,i)}))}i(c.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function I(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=s(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function S(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var o=-1,u=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return u.next=u}}return{next:A}}function A(){return{value:t,done:!0}}return g.prototype=h,c(w,"constructor",h),c(h,"constructor",g),g.displayName=c(h,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,i,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},O(x.prototype),c(x.prototype,u,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var u=new x(l(t,n,r,o),a);return e.isGeneratorFunction(n)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},O(w),c(w,i,"Generator"),c(w,a,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return i.type="throw",i.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a],i=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var c=r.call(u,"catchLoc"),l=r.call(u,"finallyLoc");if(c&&l){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var u=a?a.completion:{};return u.type=e,u.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:S(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=r}catch(o){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";n.r(t),n.d(t,"couponFormFactory",(function(){return f}));var r=n(1),o=n.n(r),a=n(4),u=n(2),i=n(0);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function u(e){d(a,r,o,u,i,"next",e)}function i(e){d(a,r,o,u,i,"throw",e)}u(void 0)}))}}var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.errorMessage,n=void 0===t?"Cupom inv\xe1lido":t,r=e.className,o=void 0===r?"alert-message":r,a=document.createElement("span");return a.className=o,a.style=Object(i.objectToInlineCss)({color:"#B91C1C","font-weight":500,"font-size":"14px","font-family":"Montserrat, sans-serif","padding-top":"6px"}),a.textContent=n,a},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.elements,n=e.productId,r=e.errorMessageOptions,c=void 0===r?{}:r;if(!t||Object.keys(t).length<1)throw new Error("Should provide elements references!");if(!n||null===n||void 0===n||!n.length)throw new Error("Should provide productId value!");if(new URLSearchParams(window.location.search).has("cupom")){var s=function(){var e=new URL(window.location.href);e.searchParams.delete("cupom"),window.location.assign(e)},d=t.clearCouponButton;return d?d.addEventListener("click",s):Rollbar&&Rollbar.error("Missing clear coupon button reference",{url:window.location.href}),{fixedCoupon:!0}}var f=t.clearCouponButton,v=t.couponInput,y=t.discountAmountSpan,g=t.errorSpanContainer,h=t.formAmountHiddenInput,b=t.paymentTotalSpan,_=t.submitCouponButton,E=t.emailInput,w=t.submitFormButton,O=[],x="",I=null,C=p(c);function j(e){O.some((function(t){return t===e}))||O.push(e)}function P(e){O=O.filter((function(t){return t!==e}))}function S(e,t){O.forEach((function(n){try{null===n||void 0===n||n(e,t)}catch(r){console.error("Failed to call listener:",{listener:n})}}))}function A(){Object(i.setElementHiddenClass)(_,!1),Object(i.disableInputField)(_,!1,!x.length),L()}function L(){C.parentElement&&C.parentElement.removeChild(C)}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;L(),e.appendChild(C)}var F=function(){var e=m(o.a.mark((function e(t,r,i){var c,s,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.CouponService.getCoupon(t,r,n,i).catch((function(e){console.debug(e),k(g)}));case 2:if(c=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return s=u.formatterCurrency.format(c.discountedAmount/100),d=u.formatterCurrency.format(c.discountAmount/100),e.abrupt("return",l(l({},c),{},{formattedDiscount:d,formattedDiscountedAmount:s}));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function N(e){e.preventDefault(),L();var t=v.value.toUpperCase();if(Object(i.setElementHiddenClass)(_,!0),Object(i.disableInputField)(v,!0,!1),t.trim().length<1&&x)return v.value=x,void Object(i.disableInputField)(v,!1,!1);if(t.trim()!=x||I!=Object(u.getLowerCaseInputValue)(E))if(t.trim().length<1)Object(i.disableInputField)(v,!1,!0);else{Object(i.disableSubmitButtonElement)(w,!0);var n=Object(u.getLowerCaseInputValue)(E);F(t,h.value,n).then((function(e){null!==e?(I=n,x=t,v.value=t,y.textContent=e.formattedDiscount,b.textContent=e.formattedDiscountedAmount,Object(i.disableInputField)(v,!0,!1),Object(i.setElementHiddenClass)(y,!1),Object(i.setElementHiddenClass)(f,!1)):I!==n?T():v.value=x,Object(i.disableInputField)(_,!0,!1),S(e)})).finally((function(){Object(i.disableInputField)(v,x.length,!x.length),Object(i.disableSubmitButtonElement)(w,!1)}))}else Object(i.disableInputField)(v,!1,!1)}function T(){L(),Object(i.setElementHiddenClass)(_,!1),Object(i.disableInputField)(v,!1,!0),S(null,!0),Object(i.setElementHiddenClass)(y,!0),Object(i.setElementHiddenClass)(f,!0),Object(i.setElementHiddenClass)(_,!0),x=""}return E.addEventListener("blur",N),v.addEventListener("blur",N),v.addEventListener("click",A),v.addEventListener("keyup",i.blurOnEnterKeyupHandler),_.addEventListener("click",i.forceBlurOnEventHandler),f.addEventListener("click",T),{fixedCoupon:!1,couponInput:v,clearCouponButton:f,submitCouponButton:_,discountAmountSpan:y,paymentTotalSpan:b,addCouponChangeListener:j,removeCouponChangeListener:P,appendErrorSpan:k,removeErrorSpan:L,elements:t}}},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=null;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];n||(n=setTimeout((function(){e.apply(void 0,o),clearTimeout(n),n=null}),t))}}n.r(t),n.d(t,"debounced",(function(){return r}))},function(e,t,n){"use strict";function r(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.classList.toggle("invisible",t),e.classList.toggle("h-0",t)}n.r(t),n.d(t,"vanishElement",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],u=!0,i=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==n.return||n.return()}finally{if(i)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=60,o=60*n,a=24*o,u=e%n,i=e-u,c=i%o/n,l=i-c*n,s=l%a/o,d=l-s*o,m=d/a,p=new Intl.NumberFormat(["pt-BR"],{minimumFractionDigits:0,maximumFractionDigits:0}).format,f=[{value:m,unit:["dia","dias"]},{value:s,unit:["hora","horas"]},{value:c,unit:["minuto","minutos"]},{value:t?0:u,unit:["segundo","segundos"]}].filter((function(e){var t=e.value;return Math.floor(t)>0})).map((function(e){var t=e.value,n=r(e.unit,2),o=n[0],a=n[1];return"".concat(p(Math.floor(t))," ").concat(1===t?o:a)}));f.length>1&&f.splice(f.length-2,2,[f[f.length-2],f[f.length-1]].join(" e "));var v=f.join(", ").trim();return v.length?v:"Agora"}n.r(t),n.d(t,"getDescriptiveTime",(function(){return a}))},function(e,t,n){"use strict";n.r(t),n.d(t,"Kajabi",(function(){return r}));var r=Object.freeze({grantOffer:function(e,t){var n=window.PM3.offersPath,r=e.client_name,o=e.client_email,a=t.product_id;fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_information:{client_name:r,client_email:o},payment_information:{product_id:a}})})}})},function(e,t,n){"use strict";n.r(t),n.d(t,"Enotas",(function(){return r}));var r=Object.freeze({createNF:function(e,t,n,r){var o={client_information:e,payment_information:t,payment_intent_id:n,is_pj:r};fetch(window.PM3.invoicesPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}})},function(e,t,n){"use strict";n.r(t),n.d(t,"FORMATTED_CC_NUM_LENGTH",(function(){return r})),n.d(t,"CC_NUM_LENGTH",(function(){return o})),n.d(t,"CC_NUM_BLOCK_SIZE",(function(){return a})),n.d(t,"CC_NUM_SPACE_POSITION_FACTOR",(function(){return u})),n.d(t,"creditCardNumberInputPartialValidator",(function(){return i})),n.d(t,"creditCardNumberInputValidator",(function(){return c})),n.d(t,"isCursorMovementKey",(function(){return l})),n.d(t,"isInSpaceChar",(function(){return s})),n.d(t,"creditCardNumberExtractor",(function(){return d})),n.d(t,"creditCardNumberFormatter",(function(){return m})),n.d(t,"handleCCInputEmptySpace",(function(){return p})),n.d(t,"ccNumKeydownHandler",(function(){return f})),n.d(t,"ccNumKeyupHandler",(function(){return v})),n.d(t,"setupCreditCardNumberInput",(function(){return g}));var r=19,o=16,a=4,u=a+1,i=/^[\d\s]+$/,c=function(e){return/^([\d]{4}\s){3}[\d]{4}$/.test(e)},l=function(e){return/arrow|home|end/i.test(e)},s=function(e){return e%u===0};function d(e){return e.split("").filter((function(e){return/^\d$/.test(e)})).slice(0,o).join("")}function m(e){return d(e).split("").reduce((function(e,t,n,o){return e.length>=r?e:e+t+((n+1)%a===0&&e.length+2<=r?" ":"")}),"").trim()}function p(e){var t=e.key,n=e.target,r=n.value,o=n.selectionStart,a=n.selectionEnd,u={value:r.slice(0),selectionStart:o,selectionEnd:a};if(o==a&&!l(t)&&s(o+1)&&s(a+1)){if(/backspace/i.test(t))return u.value=r.split("").filter((function(e,t){return t!==o-1})).join(""),u.selectionStart-=2,u.selectionEnd-=2,u;if(/delete/i.test(t))return u.value=r.split("").filter((function(e,t){return t!==o})).join(""),u}return r.slice(r.slice(0,a).lastIndexOf(" "),a+1).length>5&&(u.selectionStart+=1,u.selectionEnd+=1),u}function f(e){var t=e.target,n=t.value,o=t.selectionStart,a=t.selectionEnd,u=n.slice(0,r);e.target.value=u,this.value=u,e.target.setSelectionRange(o,a)}function v(e){var t=p(e),n=t.value;if(n.length){var o=m(n),a=t.value.length>=r&&t.selectionStart>=r&&t.selectionEnd>=r;if(o!=n){var u=n.length>=r,i=o.length-n.length;this.value=o.slice(0,r);var c=u?0:i;e.target.setSelectionRange(t.selectionStart+c,t.selectionEnd+c),a&&e.target.nextElementSibling.focus()}else a&&e.target.nextElementSibling.focus()}}function y(e){var t=e.clipboardData.getData("text");e.preventDefault(t),this.value=m(t)}function g(e){e.addEventListener("keydown",f),e.addEventListener("keyup",v),e.addEventListener("paste",y);var t={get:function(e,t,n){var r,o;switch(t){case"value":return d(null!==(r=e.value)&&void 0!==r?r:"");case"valid":return c(null!==(o=e.value)&&void 0!==o?o:"");case"_self":return e;default:return Reflect.get.apply(Reflect,arguments)}},set:function(e,t,n,r){return"value"!==t?Reflect.set.apply(Reflect,arguments):(e.value=m(n.toString()),!0)}};return new Proxy(e,t)}},function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],u=!0,i=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==n.return||n.return()}finally{if(i)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){return e.replace(/^([1-9]\/|[2-9])$/g,"0$1/").replace(/^(0[1-9]|1[0-2])$/g,"$1/").replace(/^([0-1])([3-9])$/g,"0$1/$2").replace(/^(0?[1-9]|1[0-2])([0-9]{2})$/g,"$1/$2").replace(/^([0]+)\/|[0]+$/g,"0").replace(/[^\d/]|^[/]*$/g,"").replace(/\/\//g,"/")}function u(e){var t=r(e.split("/"),2),n=t[0],o=t[1];return o.length&&o.length<3?[n,(new Date).getFullYear().toFixed(0).slice(0,2)+o.padStart(2,"0")].join("/"):e}function i(e){var t=r(e.slice(0,7).split("/"),2),n=t[0],o=t[1];if(Number.isNaN(+n))return"";var a=(+n>12||+n<1?1:Number(n)).toString().padStart(2,"0");return null!==o&&void 0!==o&&o.length&&o.length>2?[a,o.slice(2).padStart(2,"0")].join("/"):[a,o].join("/")}function c(e){var t=r(e.split("/"),2),n=t[0],o=t[1],a=(new Date).getFullYear(),u=a.toFixed(0).slice(0,2);if(3===o.length||Number.isNaN(o)||+o<1)return!1;var i=Number(o.length<4?u+o.toFixed(0).padStart(2,"0"):o.toFixed(0));if(i<a)return!1;var c=Number(n);return!(!Number.isNaN(c)||c<1||c>12)&&(i>a||c>=(new Date).getMonth()+1)}function l(e){if(![8,46].includes(e.keyCode)){var t=e.target.value.slice(0,5);e.target.value=a(t)}}function s(e){var t=e.target,n=t.selectionStart,r=t.selectionEnd,o=e.target.value.length>=5&&n>=5&&r>=5;e.target.value=e.target.value.slice(0,5),o&&e.target.nextElementSibling.focus()}function d(e){var t=e.clipboardData.getData("text");e.target.value=a(t)}function m(e){return e.addEventListener("keydown",l),e.addEventListener("keyup",s),e.addEventListener("paste",d),new Proxy(e,{get:function(e,t,n){var r;switch(t){case"value":return u(null!==(r=e.value)&&void 0!==r?r:"");case"_self":return e;default:return Reflect.get.apply(Reflect,arguments)}},set:function(e,t,n,r){return"value"!==t?Reflect.set.apply(Reflect,arguments):(e.value=a(i(n)),!0)}})}n.r(t),n.d(t,"replaceStringDate",(function(){return a})),n.d(t,"ccEDExtractor",(function(){return u})),n.d(t,"ccEDFormatter",(function(){return i})),n.d(t,"ccEDValidator",(function(){return c})),n.d(t,"ccEDKeydownHandler",(function(){return l})),n.d(t,"ccEDKeyupHandler",(function(){return s})),n.d(t,"ccEDPasteHandler",(function(){return d})),n.d(t,"setupCCExpirationDateInput",(function(){return m}))},function(e,t,n){"use strict";n.r(t),n.d(t,"numericOnlyFilter",(function(){return r})),n.d(t,"filterNonNumericCharacters",(function(){return o})),n.d(t,"CVVFilter",(function(){return a})),n.d(t,"ccEDKeydownHandler",(function(){return u})),n.d(t,"ccEDKeyupHandler",(function(){return i})),n.d(t,"ccEDPasteHandler",(function(){return c})),n.d(t,"setupCCCVVInput",(function(){return l}));function r(e){return/^\d$/.test(e)}function o(e){return e.split("").filter(r).join("")}function a(e){return o(e.slice(0,3))}function u(e){e.target.value=a(e.target.value)}function i(e){e.target.value=a(e.target.value)}function c(e){e.target.value=a(e.target.value)}function l(e){return e.addEventListener("keydown",u),e.addEventListener("keyup",i),e.addEventListener("paste",c),new Proxy(e,{get:function(e,t,n){switch(t){case"value":return a(e.value);case"_self":return e;default:return Reflect.get.apply(Reflect,arguments)}},set:function(e,t,n,r){return"value"!==t?Reflect.set.apply(Reflect,arguments):(e.value=a(n.toString()),!0)}})}},function(e,t,n){"use strict";n.r(t),n.d(t,"setupMPMTabs",(function(){return l}));var r=n(9);function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=[];function i(e){u=[].concat(o(u),[e])}function c(e){u=u.filter((function(t){return t!==e}))}function l(e){var t=Array.from(document.getElementsByClassName("tab-trigger")).map((function(t,n,o){var a,i,c,l=null===t||void 0===t||null===(a=t.dataset)||void 0===a?void 0:a.contentContainerId,s=document.getElementById(l),d=(i=o,c=e,function(e){var t,n=this;if(e.preventDefault(),!e.target.disabled){var o=null===(t=this.dataset)||void 0===t?void 0:t.contentContainerId;i.forEach((function(e){e.classList.toggle("active-tab",n===e)})),Array.from(c.children).forEach((function(e){if(null!==e&&void 0!==e&&e.classList.contains("mpm-tab-contents")){var t=e.id===o;Object(r.vanishElement)(e,!t)}})),u.forEach((function(e){e(n.dataset.paymentMethod,n)}))}});return t.addEventListener("click",d),{clickHandler:d,element:t,contentContainerElement:s}}));return{addListener:i,removeListener:c,setButtonsDisabled:function(e){t.forEach((function(t){var n=t.element;e?(n.classList.toggle("disabled",!0),n.setAttribute("disabled",!0)):(n.classList.toggle("disabled",!1),n.removeAttribute("disabled"))}))}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"initPix",(function(){return f})),n.d(t,"setupPixPayment",(function(){return v}));var r=n(1),o=n.n(r),a=n(2),u=n(3),i=n(0),c=n(10);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function u(e){m(a,r,o,u,i,"next",e)}function i(e){m(a,r,o,u,i,"throw",e)}u(void 0)}))}}function f(e){var t,n,r,u=e.showPaymentError,i=e.setLoading,l=window.PM3.PIX_STATUS_POLLING_TIME_LIMIT||3e5,s=window.PM3.PIX_STATUS_POLLING_INTERVAL||5e3,d=window.PM3.PIX_EXPIRATION_UPDATE_INTERVAL||6e4;function m(e,t){return fetch("/client_instant_payments/".concat(e),{signal:t}).then(function(){var e=p(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=7;break}return e.next=3,t.json();case 3:return n=e.sent,r=n.status,a=n.error,e.abrupt("return",{status:r,error:a});case 7:return e.t0=void 0,e.next=10,t.text();case 10:return e.t1=e.sent,e.abrupt("return",{status:e.t0,error:e.t1});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return{status:void 0,error:{type:"requestError",error:e}}}))}function f(){var e,r;null===(e=t)||void 0===e||e(),null===(r=n)||void 0===r||r();var o=document.getElementById("pix-dialog");o.open&&o.close();var a=o.querySelector(".amount-header"),u=o.querySelector("img.qr-code-img"),i=o.querySelector("button.qr-code-data-copy-cta"),c=o.querySelector(".qr-code-expiration-info");u.src="",i.dataset.qrCode="",a.textContent="",c.textContent="Vence em"}document.getElementById("pix-dialog").querySelector(".close-qr-code-cta").addEventListener("click",f),document.getElementById("pix-dialog").addEventListener("cancel",(function(e){e.preventDefault(),f()})),document.getElementById("pix-dialog").querySelector("button.qr-code-data-copy-cta").addEventListener("click",function(){var e=p(o.a.mark((function e(){var t,n,a,u,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("pix-dialog"),n=t.querySelector("button.qr-code-data-copy-cta"),a=n.dataset.qrCode,navigator&&"clipboard"in navigator){e.next=5;break}throw new Error("Failed to copy Pix QR Code, Clipboard API not available");case 5:if(a){e.next=7;break}throw new Error("Tried to copy empty Pix QR Code");case 7:return e.next=9,navigator.clipboard.writeText(a);case 9:r&&clearTimeout(r),u=n.querySelector(".qr-code-data-copy-cta-label"),i=u.textContent,u.textContent="Copiado!",r=setTimeout((function(){u.textContent!==i&&(u.textContent=i)}),3e3);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());var v=new Intl.DateTimeFormat(["pt-BR"],{day:"numeric",month:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit"});return{showQrCodeDialog:function(e,r,f,y,g){i(!0),u("");var h=document.getElementById("pix-dialog"),b=h.querySelector(".amount-header"),_=h.querySelector("img.qr-code-img"),E=h.querySelector("button.qr-code-data-copy-cta"),w=h.querySelector(".qr-code-expiration-info");_.src=f,E.dataset.qrCode=y,b.textContent=a.formatterCurrency.format(r/100);var O=Date.now()+1e3*g;function x(){var e,t=O-Date.now(),r=v.format(O);t<0?(null===(e=n)||void 0===e||e(),w.textContent="Venceu em ".concat(r)):w.textContent="Vence em ".concat(r," (").concat(Object(c.getDescriptiveTime)(t/1e3,!0),")")}if(d){var I=setInterval(x,d);n=function(){clearInterval(I),n=void 0}}return x(),h.showModal(),i(!1),function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&(t(),t=void 0);var a,u=new AbortController,i=new Promise((function(t,c){var d=r?1e3*r:l,f=Date.now()+d;n=function(){t("pending")},function n(){a&&clearTimeout(a),a=setTimeout(p(o.a.mark((function r(){var a,l,s,d;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Date.now()>f,r.next=3,m(e,u.signal);case 3:if(l=r.sent,s=l.status,!(d=l.error)){r.next=9;break}return i.cancel(d),r.abrupt("return",c(d));case 9:if("pending"===s){r.next=11;break}return r.abrupt("return",t(s));case 11:if(!a){r.next=13;break}return r.abrupt("return",t("pending"));case 13:n();case 14:case"end":return r.stop()}}),r)}))),s)}()}));return i.cancel=function(e){!e&&n&&n(),clearTimeout(a),u.abort()},t=i.cancel,i}(e,1e3*g)},closeQrCodeDialog:f}}function v(e){var t=e.clientForm,n=e.productForm,r=e.couponForm,c=e.formElements,l=e.formHelpers,d=e.showPaymentError,m=e.setLoading,v=e.gtm,y=e.setPaymentMethodSubmitHandler,g=e.onSuccess,h=e.onPending,b=e.onError,_=function(e){return m(e,{label:c.submitButtonLabel,loading:c.loadingIndicator})},E=f({showPaymentError:d,setLoading:_}),w=E.showQrCodeDialog,O=E.closeQrCodeDialog,x=document.getElementById("pix_total_amount");function I(){return(I=p(o.a.mark((function e(){var r,a,l,p,f,y,E,x,I,C,j,P,S,A,L,k,F;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getId(),a=t.getFormData(),l=c.getAmountAndCouponInformation(),(p={provider:"malga",payment_method:"pix",product_id:r,client_payment:{product_id:r,installments_count:1,provider:"malga",payment_type:"pix"},coupons:c.getAmountAndCouponInformation()}).client_payment=s(s({},p.client_payment),{},{product_id:r,name:a.name,email:a.email,is_pj:a.is_pj,is_foreigner:a.is_foreigner,document:a.document,phone_number:a.phone_number,whatsapp_accept:a.whatsapp_accept,coupon_id:l.coupon_id,amount_off:l.coupon_amount_off,percent_off:l.counpon_percent_off,discount_amount:l.discount_amount,amount:l.subtotal_amount,total_amount:l.total_amount}),e.next=7,fetch("/client_instant_payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(i.parseFetchResponse).catch((function(e){return console.trace({error:e}),null}));case 7:if(f=e.sent){e.next=12;break}return _(!1),d("Ocorreu um erro. Verifique os dados preenchidos e tente novamente em alguns minutos"),e.abrupt("return");case 12:return y=f.body,E=y.id,x=y.product_id,I=y.product_name,C=y.unit_amount,j=y.amount,P=y.transaction_id,S=y.coupon_id,A=y.pix,e.next=15,w(E,j,A.qrCodeImageUrl,A.qrCodeData,A.expiresIn);case 15:if("authorized"!==(L=e.sent)){e.next=29;break}return v.registerPurchaseEvent(u.PAYMENT_TYPE.nupay,{product_id:x,product_name:I,transaction_id:P,coupon_id:S,unitAmount:C,totalAmount:j}),e.next=20,fetch("/client_instant_payments/".concat(E),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stripe_payment_intent:{status:L}})}).then(i.parseFetchResponse).catch((function(e){return console.error("Failed to update client instant payment with confirmed payment intent:",e),null}));case 20:if(null!==(k=e.sent)&&200===k.status){e.next=24;break}throw d("Ocorreu um erro ao confirmar o pagamento. Verifique os dados e tente novamente."),new Error(null!==(F=null===k||void 0===k?void 0:k.body)&&void 0!==F?F:"Failed to update client instant payment");case 24:_(!1),m(!1),g(),e.next=30;break;case 29:["pre_authorized","pending"].includes(L)?(_(!1),m(!1),h()):(m(!1),_(!1),O(),b());case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r&&!r.fixedCoupon&&r.addCouponChangeListener((function(e){var t=c.getProductInfo({formatted:!1}).unitAmount,n=null!==e&&void 0!==e&&e.discountedAmount?+e.discountedAmount/100:null,r=a.formatterCurrency.format(null!==n&&void 0!==n?n:t);x.innerText="Valor ".concat(r)})),y("pix",(function(e){if(d(""),l.cpfCnpjValidator()){if(t.isClientPj()&&Object(i.doesNotHaveValue)(t.inputs.stateRegistrationInput)&&Object(i.doesNotHaveValue)(t.inputs.municipalRegistrationInput))return c.stateRegistrationAlertMessageElement&&(c.stateRegistrationAlertMessageElement.className="",c.stateRegistrationAlertMessageElement.style="color:#FF5757; font-weight:600;"),void d("Verifique as informa\xe7\xf5es inseridas");c.stateRegistrationAlertMessageElement&&(c.stateRegistrationAlertMessageElement.className="hidden"),m(!0),_(!0);var n=c.getProductInfo({formatted:!1}),r=c.getAmountAndCouponInformation({formatted:!1});v.registerCheckoutOptionEvent(u.PAYMENT_TYPE.pix,{productId:n.productId,productName:n.productName,unitAmount:n.unitAmount.toFixed(2),couponId:r.coupon_id,amountOff:r.discount_amount,totalAmount:r.total_amount}),function(){return I.apply(this,arguments)}().catch((function(e){var t;d(e.message),m(!1),_(!1),console.error("Failed to create payment method",e.message,null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:e)}))}else d("".concat(Object(i.isPJ)(t.inputs.clientType.value)?"CNPJ":"CPF"," inv\xe1lido"))}))}},function(e,t,n){"use strict";n.r(t),n.d(t,"setupClientForm",(function(){return c}));var r=n(0),o=n(9);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){var t=document.getElementById("client_payment_client_type"),n=document.getElementById("client_payment_form"),a=document.getElementById("client_payment_name"),i=document.getElementById("client_payment_email"),c=document.getElementById("client_payment_document"),l=document.getElementById("is_foreigner"),s=document.getElementById("client_payment_phone_number"),d=document.getElementById("whatsapp_checkbox"),m=n.querySelector("input#client_payment_state_registration"),p=n.querySelector("input#client_payment_municipal_registration"),f=document.getElementById("client_created_at");function v(){return Object(r.isPJ)(t.value)}return{isClientPj:v,getClientInformation:function(){var e,t;return{client_name:a.value,client_email:i.value,client_document:c.value,client_phone_number:s.value,client_created_at:f.value,client_whatsapp_accept:d.checked,client_state_registration:null!==(e=null===m||void 0===m?void 0:m.value.trim())&&void 0!==e?e:"",client_municipal_registration:null!==(t=null===p||void 0===p?void 0:p.value.trim())&&void 0!==t?t:""}},getFormData:function(){var e=v(),t={name:a.value,email:i.value,is_pj:e,is_foreigner:l.checked,document:c.value,phone_number:s.value,whatsapp_accept:d.checked,created_at:f.value};return u(u({},t),{},e?{state_registration:m.value,municipalRegistrationInput:p.value}:{is_foreigner:null===l||void 0===l?void 0:l.checked})},setPersonalDocumentRequired:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!v()){Object(o.vanishElement)(l.parentElement,e);var t=document.querySelector("label[for=client_payment_document]"),n=document.querySelector("#document_validation");e?(c.setAttribute("required",!0),t.classList.add("required"),t.querySelector("small").classList.add("inline-zero-width")):(c.removeAttribute("required"),t.classList.remove("required"),t.querySelector("small").classList.remove("inline-zero-width"),n.classList.add("hidden"))}},setPersonalPhoneNumberRequired:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!v()){var t=document.querySelector('label[for="'.concat(s.id,'"]'));e?(s.setAttribute("required",!0),t.classList.add("required"),t.querySelector("small").classList.add("inline-zero-width")):(s.removeAttribute("required"),t.classList.remove("required"),t.querySelector("small").classList.remove("inline-zero-width"))}},inputs:{clientTypeInput:t,nameInput:a,emailInput:i,documentInput:c,isForeignerInput:l,phoneNumberInput:s,whatsappAcceptElement:d,stateRegistrationInput:m,municipalRegistrationInput:p}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"setupProductForm",(function(){return o}));var r=n(2);function o(){var e=document.getElementById("product_id"),t=document.getElementById("product_name"),n=document.getElementById("unit-amount")||document.getElementById("payment-total"),o=document.getElementById("provider");return{getId:function(){return e.value},getName:function(){return t.value},getProvider:function(){return o.value},getUnitAmountValue:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?n:Object(r.getValueWithoutFormat)(null===n||void 0===n?void 0:n.innerText)/100},inputs:{idHiddenInput:e,nameHiddenInput:t,unitAmountHiddenInput:n}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"initNupay",(function(){return f})),n.d(t,"setupNupayPayment",(function(){return v}));var r=n(1),o=n.n(r),a=n(2),u=n(3),i=n(0);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function u(e){d(a,r,o,u,i,"next",e)}function i(e){d(a,r,o,u,i,"throw",e)}u(void 0)}))}}var p=3e5;function f(e){var t,n=e.setLoading,r=e.showPaymentError;function a(e,t){return fetch("/client_instant_payments/".concat(e),{signal:t}).then(function(){var e=m(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=7;break}return e.next=3,t.json();case 3:return n=e.sent,r=n.status,a=n.error,e.abrupt("return",{status:r,error:a});case 7:return e.t0=void 0,e.next=10,t.text();case 10:return e.t1=e.sent,e.abrupt("return",{status:e.t0,error:e.t1});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return{status:void 0,error:{type:"requestError",error:e}}}))}function u(){t&&t(),document.getElementById("nupay-dialog").close()}return document.getElementById("nupay-dialog").querySelector("button.close-dialog").addEventListener("click",u),document.getElementById("nupay-dialog").addEventListener("cancel",(function(e){e.preventDefault(),u()})),{showDialog:function(e,u){return n(!0),r(""),document.getElementById("nupay-dialog").showModal(),function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&(t(),t=void 0);var u,i=new AbortController,c=new Promise((function(t,l){var s=r?1e3*r:p,d=Date.now()+s;n=function(){t("pending")},function n(){u&&clearTimeout(u),u=setTimeout(m(o.a.mark((function r(){var u,s,m,p;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=Date.now()>d,r.next=3,a(e,i.signal);case 3:if(s=r.sent,m=s.status,!(p=s.error)){r.next=9;break}return c.cancel(p),r.abrupt("return",l(p));case 9:if("pending"===m){r.next=11;break}return r.abrupt("return",t(m));case 11:if(!u){r.next=13;break}return r.abrupt("return",t("pending"));case 13:n();case 14:case"end":return r.stop()}}),r)}))),5e3)}()}));return c.cancel=function(e){!e&&n&&n(),clearTimeout(u),i.abort()},t=c.cancel,c}(e,1e3*u)},closeDialog:u}}function v(e){var t=e.clientForm,n=e.productForm,r=e.couponForm,c=e.formElements,s=e.formHelpers,d=e.showPaymentError,p=e.setLoading,v=e.gtm,y=e.setPaymentMethodSubmitHandler,g=e.onSuccess,h=e.onPending,b=e.onError,_=function(e){return p(e,{label:c.submitButtonLabel,loading:c.loadingIndicator})},E=f({setLoading:_,showPaymentError:d}),w=E.showDialog,O=E.closeDialog,x=document.getElementById("nupay_total_amount");function I(){return(I=m(o.a.mark((function e(){var r,a,s,m,f,y,E,x,I,C,j,P,S,A,L,k;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getId(),a=t.getFormData(),s=c.getAmountAndCouponInformation(),(m={provider:"malga",payment_method:"nupay",product_id:r,client_payment:{product_id:r,installments_count:1,provider:"malga",payment_type:"nupay"},coupons:c.getAmountAndCouponInformation()}).client_payment=l(l({},m.client_payment),{},{product_id:r,name:a.name,email:a.email,is_pj:a.is_pj,is_foreigner:a.is_foreigner,document:a.document,phone_number:a.phone_number,whatsapp_accept:a.whatsapp_accept,coupon_id:s.coupon_id,amount_off:s.coupon_amount_off,percent_off:s.counpon_percent_off,discount_amount:s.discount_amount,amount:s.subtotal_amount,total_amount:s.total_amount}),e.next=7,fetch("/client_instant_payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(i.parseFetchResponse).catch((function(e){return console.trace({error:e}),null}));case 7:if(f=e.sent){e.next=12;break}return _(!1),d("Ocorreu um erro. Verifique os dados preenchidos e tente novamente em alguns minutos"),e.abrupt("return");case 12:return y=f.body,E=y.id,x=y.product_id,I=y.product_name,C=y.unit_amount,j=y.amount,P=y.transaction_id,S=y.coupon_id,v.registerPurchaseEvent(u.PAYMENT_TYPE.nupay,{product_id:x,product_name:I,transaction_id:P,coupon_id:S,unitAmount:C,totalAmount:j}),e.next=16,w(E);case 16:if("authorized"!==(A=e.sent)){e.next=29;break}return e.next=20,fetch("/client_instant_payments/".concat(E),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stripe_payment_intent:{status:A}})}).then(i.parseFetchResponse).catch((function(e){return console.error("Failed to update client instant payment with confirmed payment intent:",e),null}));case 20:if(null!==(L=e.sent)&&200===L.status){e.next=24;break}throw d("Ocorreu um erro ao confirmar o pagamento. Verifique os dados e tente novamente."),new Error(null!==(k=null===L||void 0===L?void 0:L.body)&&void 0!==k?k:"Failed to update client instant payment");case 24:_(!1),p(!1),g(),e.next=30;break;case 29:["pre_authorized","pending"].includes(A)?(_(!1),p(!1),h()):(p(!1),_(!1),O(),b());case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r&&!r.fixedCoupon&&r.addCouponChangeListener((function(e){var t=c.getProductInfo({formatted:!1}).unitAmount,n=null!==e&&void 0!==e&&e.discountedAmount?+e.discountedAmount/100:null,r=a.formatterCurrency.format(null!==n&&void 0!==n?n:t);x.innerText="Valor ".concat(r," em at\xe9 24x")})),y("nupay",(function(e){if(d(""),s.cpfCnpjValidator()){if(t.isClientPj()&&Object(i.doesNotHaveValue)(t.inputs.stateRegistrationInput)&&Object(i.doesNotHaveValue)(t.inputs.municipalRegistrationInput))return c.stateRegistrationAlertMessageElement&&(c.stateRegistrationAlertMessageElement.className="",c.stateRegistrationAlertMessageElement.style="color:#FF5757; font-weight:600;"),void d("Verifique as informa\xe7\xf5es inseridas");c.stateRegistrationAlertMessageElement&&(c.stateRegistrationAlertMessageElement.className="hidden"),p(!0),_(!0);var n=c.getProductInfo({formatted:!1}),r=c.getAmountAndCouponInformation({formatted:!1});v.registerCheckoutOptionEvent(u.PAYMENT_TYPE.nupay,{productId:n.productId,productName:n.productName,unitAmount:n.unitAmount.toFixed(2),couponId:r.coupon_id,amountOff:r.discount_amount,totalAmount:r.total_amount}),function(){return I.apply(this,arguments)}().catch((function(e){var t;d(e.message),p(!1),_(!1),console.error("Failed to create payment method",e.message,null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:e)}))}else d("".concat(Object(i.isPJ)(t.inputs.clientType.value)?"CNPJ":"CPF"," inv\xe1lido"))}))}},,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"setupMalgaPayment",(function(){return I}));var r=n(1),o=n.n(r),a=n(3),u=n(2),i=n(0),c=n(7),l=n(11),s=n(5),d=n(12),m=n(8),p=n(13),f=n(14),v=n(15),y=n(16),g=n(17),h=n(18),b=n(19),_=n(20);function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],u=!0,i=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==n.return||n.return()}finally{if(i)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(l){return void n(l)}i.done?t(c):Promise.resolve(c).then(r,o)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function u(e){O(a,r,o,u,i,"next",e)}function i(e){O(a,r,o,u,i,"throw",e)}u(void 0)}))}}function I(e){return C.apply(this,arguments)}function C(){return C=x(o.a.mark((function e(t){var n,r,y,w,O,I,C,j,P,S,A,L,k,F,N,T,B,D,q,M,R,V,H,U,J,$,Y,z,K,G,W,X,Q,Z,ee,te,ne,re,oe,ae,ue,ie,ce,le,se,de,me,pe,fe,ve,ye,ge,he,be,_e,Ee,we,Oe,xe,Ie,Ce,je,Pe,Se,Ae;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ae=function(e){var t=e.success,n=e.pending,r=e.error,o={stateRegistrationAlertMessageElement:$,submitButtonElement:W,submitButtonLabel:Pe,loadingIndicator:je,getProductInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.formatted,n=void 0===t||t;return{productId:y.value,productName:w.value,unitAmount:n?Object(u.getFormattedCurrencyValueFromEl)(V):Object(u.getValueWithoutFormat)(V.value)/100}},getAmountAndCouponInformation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.formatted,n=void 0===t||t;return{coupon_id:D.value,coupon_amount_off:n?Object(u.getFormattedCurrencyValueFromEl)(q):q.value/100,coupon_percent_off:M.value||+M.value,discount_amount:n?Object(u.getFormattedCurrencyValueFromEl)(R):R.value/100,subtotal_amount:n?null===O||void 0===O?void 0:O.innerText:Object(u.getValueWithoutFormat)(null===O||void 0===O?void 0:O.innerText)/100,total_amount:n?Object(u.getFormattedCurrencyValueFromEl)(H):+H.value/100}}};return{gtm:pe,clientForm:ee,productForm:me,couponForm:re,formHelpers:Z,formElements:o,setLoading:ie,showPaymentError:ce,setPaymentMethodSubmitHandler:Ie,onSuccess:function(){Se(t.redirectURL,t.label)},onPending:function(){Se(n.redirectURL,n.label)},onError:function(){Se(r.redirectURL,r.label)}}},Se=function(e,t){ie(!1),Object(i.disableSubmitButtonElement)(W),setTimeout((function(){window.parent.location.replace(e)}),2e3),je.classList.remove("hidden"),Pe.innerText=t},Ie=function(e,t){e in xe?console.error("Attempt to overwrite payment method handler already assigned:",e):xe[e]=t},Oe=function(){if(Z.cpfCnpjValidator()){if(Object(i.isPJ)(I.value)&&Object(i.doesNotHaveValue)(N)&&Object(i.doesNotHaveValue)(T))return $&&($.className="",$.style="color:#FF5757; font-weight:600;"),void ie(!1);$&&($.className="hidden"),we()}else ie(!1)},fe=function(){var e=document.querySelector("#payment-input-form .credit-card-number-input"),t=document.querySelector("#payment-input-form .credit-card-expiration-date-input"),n=document.querySelector("#payment-input-form .credit-card-cvv-input"),r=Object(p.setupCreditCardNumberInput)(e),o=Object(f.setupCCExpirationDateInput)(t),a=Object(v.setupCCCVVInput)(n);return window.PM3.fillPaymentFormWithValidSandboxCreditCard=function(){r.value="4019598346009339",o.value="12/"+((new Date).getFullYear()+1),a.value="120"},{creditCardNumber:r,expirationDate:o,cvv:a}},le=function(e){var t;s.webhook.sendPost("/webhooks",{error_level:"tokenization",error_code:e,payment_intent_id:r,product_name:w.value,product_id:y.value,coupon_id:null===ne||void 0===ne||null===(t=ne.couponInput)||void 0===t?void 0:t.value},{"Content-Type":"application/json","X-Payment-Error":"tokenization"})},!0,r=null,y=document.getElementById("product_id"),w=document.getElementById("product_name"),O=document.getElementById("unit-amount")||document.getElementById("payment-total"),I=document.getElementById("client_payment_client_type"),C=Object(i.isPJ)(I.value),j=document.getElementById("client_payment_form"),P=document.getElementById("client_payment_name"),S=document.getElementById("client_payment_email"),A=document.getElementById("client_payment_document"),L=document.getElementById("is_foreigner"),k=document.getElementById("client_payment_phone_number"),F=document.getElementById("whatsapp_checkbox"),N=j.querySelector("input#client_payment_state_registration"),T=j.querySelector("input#client_payment_municipal_registration"),B=document.getElementById("provider"),D=document.getElementById("client_payment_coupon_id"),q=document.getElementById("client_payment_amount_off"),M=document.getElementById("client_payment_percent_off"),R=document.getElementById("client_payment_discount_amount"),V=document.getElementById("client_payment_amount"),H=document.getElementById("client_payment_total_amount"),U=document.getElementById("client_payment_installments_count"),J=document.getElementById("client_payment_fixed_installments"),$=document.querySelector("#error_registration"),Y=document.querySelector("#document_validation"),z=document.getElementById("whatsapp_label"),K=document.getElementById("document_label"),G=document.getElementById("show-installments"),document.getElementById("payment-input-form"),W=document.querySelector("#submit"),X=W.querySelector("#pay-now-button-spinner"),Q=W.querySelector("#pay-now-button-label"),Z=Object(i.checkoutCustomerFormHelpers)({alertMessageDocumentElement:Y,documentLabelElement:K,formDocumentElement:A,formPhoneNumberElement:k,formClientType:I,isForeignerElement:L,submitButtonElement:W,whatsappAcceptElement:F,whatsappLabelElement:z}),ee=Object(h.setupClientForm)(Z),te=Array.from(document.querySelectorAll('form#client_payment_form select[name="client_payment[installments_count]"] > option')),ne=window.coupon_accepted&&{formAmountHiddenInput:V,couponInput:document.getElementById("coupon_id"),discountAmountSpan:document.getElementById("discount-amount"),paymentTotalSpan:document.getElementById("payment-total"),clearCouponButton:document.getElementById("clear_coupon"),errorSpanContainer:null===(n=document.getElementById("coupon-container"))||void 0===n?void 0:n.parentElement,submitCouponButton:document.getElementById("submit_coupon"),emailInput:S,submitFormButton:W},re=window.coupon_accepted&&Object(c.couponFormFactory)({elements:ne,productId:y.value}),window.coupon_accepted&&(oe=null,re&&!re.fixedCoupon&&(ae=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var n=Number(U.value),r=u.formatterCurrency.format(Number(e)/n);G.innerText="".concat(n,"x ").concat(r," sem juros")}else te.forEach((function(t){var n=Number(t.value),r=u.formatterCurrency.format(Number(e)/n);t.innerText="".concat(n,"x ").concat(r," sem juros")}))},re&&(ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Number(V.value)/100,r=u.formatterCurrency.format(n);return t?(D.value="",H.value=V.value,R.value="",q.value="",M.value="",ne.paymentTotalSpan.innerText=r,ne.discountAmountSpan.innerText="",void ae(n,"true"===(null===J||void 0===J?void 0:J.value))):null===e&&D.value?(null!==oe&&clearTimeout(oe),void(oe=setTimeout((function(){re.removeErrorSpan()}),3e3))):void(null!==e?(re.removeErrorSpan(),q.value=e.amountOff,D.value=e.coupon,R.value=e.discountAmount,H.value=e.discountedAmount,M.value=e.percentOff,ne.paymentTotalSpan.innerText=e.formattedDiscountedAmount,ne.discountAmountSpan.innerText=e.formattedDiscount,ae(e.discountedAmount/100,"true"===(null===J||void 0===J?void 0:J.value))):re.appendErrorSpan())},re.addCouponChangeListener(ue)))),ie=function(e){Object(i.disableSubmitButtonElement)(W,e),null===t||void 0===t||t.setButtonsDisabled(e),Object(i.setElementHiddenClass)(X,!e),Object(i.setElementHiddenClass)(Q,e)},ce=function(e){ie(!1),document.querySelector("#card-error").textContent=e},se=function(){return{coupon_amount_off:Object(u.getFormattedCurrencyValueFromEl)(q),discount_amount:Object(u.getFormattedCurrencyValueFromEl)(R),subtotal_amount:null===O||void 0===O?void 0:O.innerText,total_amount:Object(u.getFormattedCurrencyValueFromEl)(H),amount:Object(u.getFormattedCurrencyValueFromEl)(V),coupon_id:D.value,coupon_percent_off:M.value,provider:B.value,product_name:w.value,product_id:y.value,installments_count:U.value}},de=function(e,t){return{name:P.value,email:S.value,document:A.value,phone_number:k.value,coupon_id:D.value,amount_off:q.value,percent_off:M.value,discount_amount:R.value,amount:(Object(u.getValueWithoutFormat)(V.value)/100).toFixed(2),total_amount:(Object(u.getValueWithoutFormat)(H.value)/100).toFixed(2),product_id:y.value,whatsapp_accept:F.checked,installments_count:U.value,payment_method_id:t?"".concat(e,":").concat(t):e,payment_intent_id:r,is_foreigner:null===L||void 0===L?void 0:L.checked,provider:B.value,is_pj:Z.pjMode}},me=Object(b.setupProductForm)(),(pe=Object(a.GtmFactory)()).sendBeginCheckout({productId:y.value,productName:w.value,unitAmount:(Object(u.getValueWithoutFormat)(V.value)/100).toFixed(2)}),ve=fe(),ye=function(){var e=x(o.a.mark((function e(){var t,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!S.value.trim().length){e.next=7;break}return t=window.PM3.paymentIntentsPath,n={payment_intent:{id:r,name:P.value,email:Object(u.getLowerCaseInputValue)(S),product_name:w.value,product_id:y.value,total_amount:H.value,phone_number:k.value}},e.next=5,s.webhook.sendPost(t,n);case 5:(a=e.sent).ok&&(r=a.body.payment_intent.id);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S.addEventListener("blur",(function(){S.value.trim().length&&ye()})),k.addEventListener("blur",(function(){k.value.trim().length&&ye()})),ge=function(){ie(!1);var e=document.getElementById("typ_url").value,t=document.getElementById("spinner-loading");Object(i.disableSubmitButtonElement)(W),setTimeout((function(){window.parent.location.replace(e)}),2e3),t.classList.remove("hidden"),Q.innerText="Pagamento feito com sucesso!"},he=function(e,t){var n={authenticity_token:E(Array.from(document.getElementsByName("authenticity_token")),1)[0].value,client_payment:de(e,t)};fetch("/client_payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(i.parseFetchResponse).then(function(){var e=x(o.a.mark((function e(t){var n,r,u,i,c,s,m,p,f,v,y,g,h,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("error_message"in t.body)){e.next=2;break}throw new Error(t.body.error_message);case 2:if(n=ee.getClientInformation(),r=se(),200!==t.status){e.next=6;break}throw new Error(null!==(u=null!==(i=null===(c=t.body)||void 0===c?void 0:c.error_message)&&void 0!==i?i:null===(s=t.body)||void 0===s?void 0:s.error)&&void 0!==u?u:"Unknown failure to register client payment");case 6:return m=t.body,p=m.product_id,f=m.coupon_id,v=m.stripe_confirm_payment_data,y=v.amount/100,g=t.body.amount/100,h={transactionId:v.id,coupon:f,totalAmount:y,productId:p,productName:v.metadata.product_name,price:g,discount:g-y},pe.sendEvent(a.CHECKOUT_STEP.purchase,h,a.PAYMENT_TYPE.card),b=[l.Kajabi.grantOffer(n,r),d.Enotas.createNF(n,r,v.id,C)],e.next=14,Promise.allSettled(b);case 14:ge();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){"stack"in e?console.error(e.stack):console.trace({error:e}),ie(!1);var t="Ocorreu um erro. Verifique os dados preenchidos e tente novamente em alguns minutos";if(e.message)if("Invalid CVV"===e.message)ce("CVV de cart\xe3o de cr\xe9dito inv\xe1lido");else ce(t);else ce(t)}))},be=window.PM3.malgaApiUrl,_e=window.PM3.malgaClientId,Ee=window.PM3.malgaClientToken,we=function(){ie(!0);var e=ve.creditCardNumber.value,t=ve.expirationDate.value,n=ve.cvv.value,r=new Headers({"Content-Type":"application/json","X-Client-ID":_e,"X-Api-Key":Ee}),i=JSON.stringify({cardHolderName:P.value,cardNumber:e,cardCvv:n,cardExpirationDate:t});return fetch("".concat(be,"/tokens"),{method:"post",headers:r,body:i}).then(function(){var e=x(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:if(n=e.sent,t.ok){e.next=5;break}throw new Error(n);case 5:return e.abrupt("return",JSON.parse(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var e=x(o.a.mark((function e(t){var i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}throw new Error(t.error.message);case 2:return e.next=5,fetch("".concat(be,"/tokens"),{method:"post",headers:r,body:JSON.stringify({cvvUpdate:n})}).then(function(){var e=x(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:if(n=e.sent,t.ok){e.next=5;break}throw new Error(n);case 5:return e.abrupt("return",JSON.parse(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0={};case 9:i=e.t0,c=function(e){return Object(u.getValueWithoutFormat)(e.value)/100},pe.sendEvent(a.CHECKOUT_STEP.add_payment_info,a.CHECKOUT_STEP.add_payment_info,{totalAmount:c(H),productId:y.value,productName:w.value,price:c(V),discount:c(q),coupon:D.value},a.PAYMENT_TYPE.card),he(t.tokenId,null===i||void 0===i?void 0:i.tokenId);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var t="message"in e?function(){try{return JSON.parse(e.message)}catch(t){return e}}():e,n="error"in t&&"declined_code"in t.error&&t.error.declined_code;switch(ie(!1),le(n),!0){case"invalid_expiration_date"===n:ce("Data de validade do cart\xe3o de cr\xe9dito inv\xe1lida");break;case"invalid_number"===n:ce("N\xfamero de cart\xe3o de cr\xe9dito inv\xe1lido");break;default:ce(e.message)}}))},xe={card:Oe},Ce=Object(m.debounced)((function(){var e,t=W.dataset.paymentMethod;t in xe||(console.error("Missing handler for payment method",t),ie(!1)),(null!==(e=xe[t])&&void 0!==e?e:xe.card)()}),1e3),j.addEventListener("submit",(function(e){e.preventDefault(),ie(!0),Ce()})),W.dataset.paymentMethod="card",null===t||void 0===t||t.addListener((function(e){W.dataset.paymentMethod=e,ee.setPersonalDocumentRequired("nupay"===e),ee.setPersonalPhoneNumberRequired("nupay"===e);var t="card"!==e;Object(i.disableRequiredInputField)(ve.creditCardNumber._self,t,!0),Object(i.disableRequiredInputField)(ve.expirationDate._self,t,!0),Object(i.disableRequiredInputField)(ve.cvv._self,t,!0)})),je=W.querySelector(".loading-indicator"),Pe=W.querySelector("span"),document.getElementById("pix-payment-form")&&Object(g.setupPixPayment)(Ae({success:{label:"Pagamento feito com sucesso!",redirectURL:document.getElementById("typ_url").value},pending:{label:"Processando pagamento via Pix",redirectURL:document.getElementById("typ_pix_processing").value.trim()||window.PM3.typPixProcessing},error:{label:"C\xf3digo Pix expirado",redirectURL:document.getElementById("typ_pix_error").value.trim()||window.PM3.typPixError}})),document.getElementById("nupay-payment-form")&&Object(_.setupNupayPayment)(Ae({success:{label:"Pagamento feito com sucesso!",redirectURL:document.getElementById("typ_url").value},pending:{label:"Processando pagamento via NuPay",redirectURL:document.getElementById("typ_pix_processing").value.trim()||window.PM3.typPixProcessing},error:{label:"Pagamento NuPay expirado",redirectURL:document.getElementById("typ_pix_error").value.trim()||window.PM3.typPixError}}));case 72:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}document.addEventListener("DOMContentLoaded",(function(){var e;try{e=Object(y.setupMPMTabs)(document.getElementById("mpm-tabs-contents"))}catch(t){console.error("Failed to start MPM Tabs:",t)}try{I(e)}catch(t){console.error("Failed to setup Malga Payment:",t)}}))}]);
//# sourceMappingURL=client_payments_malga-7de8da923d1c93452359.js.map